generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============ ENUM USER ============
enum Role {
  SUPER_ADMIN
  ADMIN
  USER
  MITRA
  INVESTOR
}

//============= ENUM TRANSAKTION STATUS ================
enum TransactionStatus {
  PENDING
  SUCCESS
  FAILED
  CANCELLED
}

//=============ENUM TRANSACTION TYPE
enum TransactionType {
  DEPOSIT // Investor masukin modal
  WITHDRAW // Investor tarik dana
  INVESTMENT // Dana masuk ke proyek tani
  DIVIDEND // Bagi hasil ke investor
  PURCHASE // Beli produk di marketplace
  REVENUE // Penjual dapet duit dari laku barang
}

// ============ USER & AUTHENTICATION ============
model User {
  id                 String            @id @default(uuid())
  email              String            @unique
  username           String            @unique
  password           String
  role               Role              @default(USER)
  status             String            @default("PENDING")
  fullName           String?
  phoneNumber        String?
  address            String?           @db.Text
  ktpNumber          String?
  birthPlace         String?
  birthDate          String?
  gender             String?
  bankAccount        String?
  npwpNumber         String?
  profilePicture     String?
  category           String?
  financeId          String?           @unique
  isVerified         Boolean           @default(false)
  resetToken         String?           @unique
  resetTokenExpires  DateTime?
  sessionVersion     Int               @default(1)
  lastPasswordUpdate DateTime?         @default(now())
  products           Product[]
  investments        Investment[]
  transactions       Transaction[]
  orders             Order[]
  charityDonations   CharityDonation[]
  balance            Float             @default(0)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  @@map("users")
}

// ============ PRODUCT & INVESTMENT ASSETS ============
model Product {
  id            String             @id @default(uuid())
  name          String
  price         Float
  roi           Float              @default(0)
  targetAmount  Float              @default(0)
  currentAmount Float              @default(0)
  duration      String?            @default("4 Bulan")
  statusProject String             @default("OPEN")
  weight        String?
  height        String?
  lineage       String?
  location      String?
  description   String?
  sellerId      String
  seller        User               @relation(fields: [sellerId], references: [id])
  img           String?
  category      String?
  stock         Int                @default(1)
  totalStock    Int                @default(1)
  isPriority    Boolean            @default(false)
  inventoryLogs ProductInventory[]
  orders        Order[]
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt

  @@map("product")
}

model ProductInventory {
  id        String  @id @default(uuid())
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  quantity  Int
  type      String // IN, OUT, RETURN
  notes     String?

  createdAt DateTime @default(now())

  @@map("product_inventory")
}

// ============ MITRA (PARTNER) ============
model Mitra {
  id            String   @id @default(uuid())
  userId        String?  @unique // Supaya tahu ini toko milik siapa
  username      String   @unique
  email         String   @unique
  farmName      String   @unique
  phoneNumber   String?
  address       String?
  city          String?
  province      String?
  description   String?
  logoUrl       String?
  fotoKtp       String
  websiteUrl    String?
  totalProducts Int      @default(0)
  totalSales    Float    @default(0)
  rating        Float    @default(0)
  isVerified    Boolean  @default(false) // Ini buat "Approved" dari Admin
  status        String   @default("PENDING") // Kita ganti default ke PENDING ya sayang biar aman
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  otpCode       String?

  @@map("mitras")
}

// ============ STORY ============
model Story {
  id             String   @id @default(uuid())
  title          String
  description    String?
  youtubeUrl     String
  youtubeVideoId String?
  thumbnail      String?
  author         String?
  tags           String[] @default([])
  views          Int      @default(0)
  likes          Int      @default(0)
  isPublished    Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("stories")
}

// ============ INVESTMENT LOGS ============
model Investment {
  id             String    @id @default(uuid())
  userId         String
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  productName    String
  investmentType String
  amount         Float
  startDate      DateTime  @default(now())
  endDate        DateTime?
  status         String    @default("ACTIVE")
  expectedReturn Float?
  actualReturn   Float?    @default(0)
  roi            Float?    @default(0)
  notes          String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("investments")
}

// ============ TRANSACTIONS & ORDERS ============
model Order {
  id              String        @id @default(uuid())
  userId          String
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  productId       String
  product         Product       @relation(fields: [productId], references: [id])
  quantity        Int
  totalPrice      Float
  logisticId      String?
  bankId          String?
  status          String        @default("PENDING")
  paymentStatus   String        @default("UNPAID")
  shippingAddress String?
  phoneNumber     String?
  resiNumber      String?       @unique
  shippingNote    String?       @default("Pesanan sedang diproses")
  transactions    Transaction[]
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@map("orders")
}

//============== TRANSACTION =================
model Transaction {
  id            String            @id @default(uuid())
  userId        String
  user          User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  orderId       String?
  order         Order?            @relation(fields: [orderId], references: [id], onDelete: SetNull)
  type          TransactionType
  amount        Float
  status        TransactionStatus @default(PENDING)
  paymentMethod String? // e.g., "BANK_TRANSFER", "XENDIT", "BALANCE"
  referenceNo   String?           @unique // Nomor referensi unik (misal: WD-123456)
  notes         String? // Catatan tambahan (misal: "Penarikan Dana Darurat")
  adminNote     String? // Catatan dari Admin (misal: "Bukti transfer tidak valid")
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  @@map("transactions")
}

// ============ CHARITY & DONATIONS ============
model CharityDonation {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  amount    Float
  message   String?
  category  String?
  createdAt DateTime @default(now())

  @@map("charity_donations")
}

//============ CHARITYLOG ===========
model CharityLog {
  id        String   @id @default(uuid())
  amount    Float
  message   String?
  createdAt DateTime @default(now())

  @@map("charity_logs")
}

// ============ SETTINGS & LOGISTICS ============
model Setting {
  id                String   @id @default("global-config")
  adminPhone        String   @default("6281108210169") // Khusus Super Admin
  siteName          String   @default("Senabrata Platform")
  youtubeCeritaKita String?  @default("https://youtube.com/...")
  articleEdufarm    String?  @db.Text
  updatedAt         DateTime @updatedAt

  @@map("setting")
}

//============ Logistic ================
model Logistic {
  id        String   @id @default(uuid())
  name      String   @unique
  price     Float
  type      String   @default("REGULAR")
  createdAt DateTime @default(now())

  @@map("logistic")
}

//============== BANK =============
model Bank {
  id            String  @id @default(uuid())
  name          String
  code          String
  accountNumber String
  accountName   String
  isActive      Boolean @default(true)

  @@map("bank")
}

//=============== LOAN PARTNER ==============
model LoanPartner {
  id          String   @id @default(cuid())
  bankName    String
  loanName    String
  limitAmount String
  interest    String
  applyUrl    String
  logoUrl     String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  @@map("loanpartner")
}

//============== REG SETTING ==============
model RegSetting {
  id        String   @id @default("terms_and_conditions")
  content   String   @db.Text
  updatedAt DateTime @updatedAt

  @@map("reg_settings")
}
